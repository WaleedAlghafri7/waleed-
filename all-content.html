<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Content - CineStream</title>
    <link rel="icon" type="image/png" href="CineStream web.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="search">
                <div class="search-icon">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <i class="fa-solid fa-xmark"></i>
                </div>
                <div class="search-input-container">
                    <input type="text" placeholder="Search for movies or series..." style="padding: 12px 15px;">
                </div>
            </div>
            <div class="name-wab" style="cursor:pointer;" onclick="window.location.href='index.html'">
                <p>CineStream</p>
            </div>
            <div class="user-list">
                <div class="list-siting">
                    <button class="list-siting-button">
                        <i class="fa-solid fa-bars"></i>
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <div class="list-siting-item">
                        <button onclick="window.location.href='index.html'" class="active">
                            <i class="fas fa-home"></i>
                            Home
                        </button>
                        <button onclick="window.location.href='movies.html'">
                            <i class="fas fa-film"></i>
                            Movies
                        </button>
                        <button onclick="window.location.href='series.html'">
                            <i class="fas fa-tv"></i>
                            Series
                        </button>
                        <button onclick="window.location.href='all-content.html'">
                            <i class="fas fa-th-large"></i>
                            All Content
                        </button>
                    </div>
                </div>
                <!-- Auth Buttons -->

                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                    <img id="user-avatar-img" alt="Avatar" style="display:none; width:40px; height:40px; border-radius:50%; object-fit:cover;" />
                </div>
                <div class="user-dropdown">
                    <div class="user-info">
                        <div class="user-details">
                            <h4 id="user-name">User Name</h4>
                            <p id="user-email">user@email.com</p>
                        </div>
                    </div>
                    <div class="user-menu">
                        <div class="auth-buttons">
                            <a href="login.html" class="btn btn-login">
                                <i class="fas fa-sign-in-alt"></i>
                                Login
                            </a>
                        </div>
                        <button onclick="window.location.href='profile.html'">
                            <i class="fa-solid fa-user-gear"></i>
                            Profile Settings
                        </button>
                        <button onclick="window.location.href='notifications.html'">
                            <i class="fa-solid fa-bell"></i>
                            Notifications
                        </button>
                        <button onclick="window.location.href='settings.html'">
                            <i class="fa-solid fa-gear"></i>
                            Settings
                        </button>
                        <button class="logout-btn">
                            <i class="fa-solid fa-right-from-bracket"></i>
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <div class="all-content">
                <div class="section-header">
                    <h2>All Content</h2>
                    <div class="filter-options">
                        <button class="filter-btn active" data-filter="all" style="display:none;">All</button>
                        <button class="filter-btn" data-filter="movies" style="display:none;">Movies</button>
                        <button class="filter-btn" data-filter="series" style="display:none;">Series</button>
                        <select class="genre-select">
                            <option value="all">All Genres</option>
                        </select>
                        <select class="sort-select">
                            <option value="latest">Latest</option>
                            <option value="rating">Rating</option>
                            <option value="popularity">Popularity</option>
                            <option value="oldest">Oldest</option>
                            <option value="az">A-Z</option>
                            <option value="za">Z-A</option>
                        </select>
                    </div>
                </div>
                <div class="content-grid">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
        <div id="footer-container"></div>
        <button class="back-arrow" onclick="history.back()" aria-label="رجوع">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>
    <script type="module">
        // ==== إدارة تسجيل الدخول ====
        function getCurrentUser() {
            try {
                const userStr = localStorage.getItem('auth_user');
                if (!userStr) return null;
                return JSON.parse(userStr);
            } catch (e) {
                return null;
            }
        }
    
        function isAuthenticated() {
            return !!localStorage.getItem('auth_token');
        }
    
        function updateAuthUI() {
            const isLoggedIn = isAuthenticated();
            const user = getCurrentUser();
    
            const userNameEl = document.getElementById('user-name');
            const userEmailEl = document.getElementById('user-email');
            const userAvatarImg = document.getElementById('user-avatar-img');
            const userAvatarIcon = document.querySelector('.user-avatar i');
            const userTopIcon = document.querySelector('.user-icon i');
            const authButtons = document.querySelector('.auth-buttons');
            const logoutBtn = document.querySelector('.logout-btn');
            const userMenu = document.querySelector('.user-menu');
    
            if (isLoggedIn && user) {
                if (userNameEl) userNameEl.textContent = user.fullName || 'User';
                if (userEmailEl) userEmailEl.textContent = user.email || '';
                if (userAvatarImg) {
                    if (user.avatarUrl) {
                        userAvatarImg.src = user.avatarUrl;
                        userAvatarImg.style.display = 'block';
                        if (userAvatarIcon) userAvatarIcon.style.display = 'none';
                        if (userTopIcon) userTopIcon.style.display = 'none';
                    } else {
                        userAvatarImg.style.display = 'none';
                        if (userAvatarIcon) userAvatarIcon.style.display = 'inline-block';
                        if (userTopIcon) userTopIcon.style.display = 'inline-block';
                    }
                }
                if (authButtons) authButtons.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'block';
                if (userMenu) {
                    const menuItems = userMenu.querySelectorAll('button');
                    menuItems.forEach(item => item.style.display = 'block');
                }
            } else {
                if (userNameEl) userNameEl.textContent = 'User Name';
                if (userEmailEl) userEmailEl.textContent = 'user@email.com';
                if (authButtons) {
                    const loginBtn = authButtons.querySelector('.btn-login');
                    const registerBtn = authButtons.querySelector('.btn-register');
                    if (loginBtn) loginBtn.style.display = 'block';
                    if (registerBtn) registerBtn.style.display = 'none';
                    authButtons.style.display = 'flex';
                }
                if (logoutBtn) logoutBtn.style.display = 'none';
                if (userMenu) {
                    const menuItems = userMenu.querySelectorAll('button');
                    menuItems.forEach(item => item.style.display = 'none');
                }
            }
    
            if (logoutBtn) {
                logoutBtn.onclick = function() {
                    localStorage.removeItem('auth_token');
                    localStorage.removeItem('auth_user');
                    updateAuthUI();
                    window.location.href = 'index.html';
                };
            }
        }
    
        fetch('header.html')
            .then(res => res.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                updateAuthUI();
            });
    
        document.addEventListener('DOMContentLoaded', updateAuthUI);
    
        // ==== البحث وقائمة المستخدم ====
        function initializeSearch() {
            const searchIcon = document.querySelector('.search-icon');
            const searchInput = document.querySelector('.search input');
            const searchContainer = document.querySelector('.search-input-container');
    
            searchIcon.addEventListener('click', () => {
                searchIcon.classList.toggle('active');
                searchInput.classList.toggle('active');
                if (searchInput.classList.contains('active')) searchInput.focus();
            });
    
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const searchQuery = searchInput.value.trim();
                    if (searchQuery) window.location.href = `search.html?q=${encodeURIComponent(searchQuery)}`;
                }
            });
    
            document.addEventListener('click', (e) => {
                if (!searchContainer.contains(e.target) && !searchIcon.contains(e.target)) {
                    searchIcon.classList.remove('active');
                    searchInput.classList.remove('active');
                }
            });
        }
    
        function initializeUserMenu() {
            const userIcon = document.querySelector('.user-icon');
            const userDropdown = document.querySelector('.user-dropdown');
            const menuButton = document.querySelector('.list-siting-button');
            const menuItems = document.querySelector('.list-siting-item');
    
            userIcon.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdown.classList.toggle('active');
                menuItems.classList.remove('active');
                menuButton.classList.remove('active');
            });
    
            menuButton.addEventListener('click', (e) => {
                e.stopPropagation();
                menuItems.classList.toggle('active');
                menuButton.classList.toggle('active');
                userDropdown.classList.remove('active');
            });
    
            userDropdown.addEventListener('click', (e) => e.stopPropagation());
            menuItems.addEventListener('click', (e) => e.stopPropagation());
    
            document.addEventListener('click', () => {
                userDropdown.classList.remove('active');
                menuItems.classList.remove('active');
                menuButton.classList.remove('active');
            });
    
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    userDropdown.classList.remove('active');
                    menuItems.classList.remove('active');
                    menuButton.classList.remove('active');
                }
            });
        }
    
        // ==== عرض المحتوى وإدارة الفلاتر ====
        let globalData = null;
        let genresPopulated = false;
    
        function extractGenres(data) {
            const genresSet = new Set();
            const addGenres = (arr) => {
                arr.forEach(item => {
                    if (item.genre) {
                        if (Array.isArray(item.genre)) item.genre.forEach(g => genresSet.add(g.trim()));
                        else if (typeof item.genre === 'string') item.genre.split(',').forEach(g => genresSet.add(g.trim()));
                    }
                });
            };
            addGenres(data.movies || []);
            addGenres(data.series || []);
            return Array.from(genresSet).filter(g => g && g.toLowerCase() !== 'unknown').sort();
        }
    
        async function loadContent() {
            try {
                if (!globalData) {
                    const response = await fetch('data.json');
                    globalData = await response.json();
                }
                const data = globalData;
                let allContent = [...data.series, ...data.movies];
    
                const params = new URLSearchParams(window.location.search);
                const initialGenre = params.get('genre');
    
                if (!genresPopulated) {
                    const genres = extractGenres(data);
                    const genreSelect = document.querySelector('.genre-select');
                    genres.forEach(genre => {
                        const opt = document.createElement('option');
                        opt.value = genre;
                        opt.textContent = genre;
                        genreSelect.appendChild(opt);
                    });
                    genresPopulated = true;
                    if (initialGenre) genreSelect.value = initialGenre;
                }
    
                const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
                if (activeFilter !== 'all') {
                    allContent = allContent.filter(item => 
                        activeFilter === 'series' || activeFilter === 'movies' ? !item.seasons : item.seasons
                    );
                }
    
                const genreValue = document.querySelector('.genre-select').value;
                if (genreValue && genreValue !== 'all') {
                    allContent = allContent.filter(item => {
                        if (!item.genre) return false;
                        if (Array.isArray(item.genre)) {
                            return item.genre.map(g => g.trim().toLowerCase()).includes(genreValue.toLowerCase());
                        } else if (typeof item.genre === 'string') {
                            return item.genre.split(',').map(g => g.trim().toLowerCase()).includes(genreValue.toLowerCase());
                        }
                        return false;
                    });
                }
    
                const sortValue = document.querySelector('.sort-select').value;
                // ترتيب حسب النوع (rating, popularity, oldest, az, za, latest)
                allContent.sort((a, b) => {
                    switch (sortValue) {
                        case 'rating':
                            return (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0);
                        case 'popularity':
                            return (parseFloat(b.popularity) || 0) - (parseFloat(a.popularity) || 0);
                        case 'oldest':
                            return new Date(a.releaseDate || a.addedDate || `${a.year}-01-01`) - new Date(b.releaseDate || b.addedDate || `${b.year}-01-01`);
                        case 'az':
                            return (a.title || '').localeCompare(b.title || '');
                        case 'za':
                            return (b.title || '').localeCompare(a.title || '');
                        default: // latest
                            return new Date(b.releaseDate || b.addedDate || `${b.year}-01-01`) - new Date(a.releaseDate || a.addedDate || `${a.year}-01-01`);
                    }
                });
    
                displayContent(allContent);
            } catch (error) {
                console.error('Error loading content:', error);
            }
        }
    
        function displayContent(content) {
            const contentGrid = document.querySelector('.content-grid');
            contentGrid.innerHTML = '';
    
            if (content.length === 0) {
                contentGrid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-film" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <p>No content found</p>
                        <p style="color: rgba(255, 255, 255, 0.5); margin-top: 10px;">Try different filters</p>
                    </div>`;
                return;
            }
    
            content.forEach(item => {
                const card = document.createElement('div');
                card.className = item.seasons ? 'series-card' : 'movie-card';
                card.onclick = () => window.location.href = `content.html?id=${item.id}&type=${item.seasons ? 'series' : 'movie'}`;
                
                card.innerHTML = `
                    ${item.seasons ? `<div class="status-indicator ${item.status}"><i class="fas ${item.status==='ongoing'?'fa-play-circle':'fa-check-circle'}"></i></div>` : ''}
                    <img src="${item.image}" alt="${item.title}" onerror="this.onerror=null; this.src='13434998.png';">
                    <div class="series-info">
                        <h3>${item.title}</h3>
                        <div class="movie-details">
                            <div class="rating"><i class="fas fa-star"></i><span>${item.rating}</span></div>
                            <div class="year"><span>${item.year ? (typeof item.year==='string'?item.year.slice(0,4):item.year) : ''}</span></div>
                        </div>
                    </div>
                `;
    
                contentGrid.appendChild(card);
    
                card.querySelectorAll('.genre-chip').forEach(chip => {
                    chip.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const g = chip.dataset.genre;
                        const url = new URL(window.location.href);
                        url.searchParams.set('genre', g);
                        history.replaceState(null, '', url.toString());
                        document.querySelector('.genre-select').value = g;
                        loadContent();
                    });
                });
            });
        }
    
        document.addEventListener('DOMContentLoaded', () => {
            initializeSearch();
            initializeUserMenu();
            loadContent();
    
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(button => button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                loadContent();
            }));
    
            document.querySelector('.sort-select').addEventListener('change', loadContent);
            document.querySelector('.genre-select').addEventListener('change', loadContent);
        });
    
        // Load header and footer (fallback)
        fetch('header.html').then(res => res.text()).then(data => document.getElementById('header-container').innerHTML = data);
        fetch('footer.html').then(res => res.text()).then(data => document.getElementById('footer-container').innerHTML = data);
    </script>
    
</body>
</html> 